<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RTG: Geometry and Representation Theory at USC</title>
  <meta name="description" content="RTG: Geometry and Representation Theory at USC — Department of Mathematics, University of Southern California." />
  <style>
    :root{
      --usc-cardinal:#990000; /* PMS 201C */
      --usc-gold:#FFCC00;     /* PMS 123C */
      --muted:#6b7280;        /* gray-500 */
      --ink:#1f2937;          /* gray-800 */
      --bg:#ffffff;
      --bg-alt:#f9f6ef;
      --radius:4px;
      --gap:16px;
      --gap-lg:24px;
      --shadow:0 1px 2px rgba(0,0,0,.06), 0 1px 3px rgba(0,0,0,.1);
      --maxw:1100px;
    }
    html{scroll-behavior:smooth}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink); background:var(--bg);
      line-height:1.5;
    }
    a{color:var(--usc-cardinal); text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:var(--maxw); margin-inline:auto; padding:0 16px}
    /* Skip link */
    .skip-link{
      position:absolute; left:-999px; top:auto; width:1px; height:1px; overflow:hidden;
    }
    .skip-link:focus{
      position:fixed; left:16px; top:16px; width:auto; height:auto; padding:8px 12px;
      background:#fff; border:2px solid var(--usc-cardinal); border-radius:var(--radius); z-index:10000;
    }
    /* Header */
    header{
      position:sticky; top:0; z-index:999; background:var(--usc-gold); box-shadow:var(--shadow);
    }
    .header-inner{display:flex; align-items:center; justify-content:space-between; gap:16px; padding:12px 0}
    .brand{display:flex; align-items:center; gap:12px}
    .brand-tile{
  width:44px;           /* fixed square instead of padded text */
  height:44px;
  padding:0;            /* remove text padding */
  background: url("photos/rtg-badge.png") center/cover no-repeat;
  color:transparent;    /* hide the “RTG” letters */
  border-radius: var(--radius);
  box-shadow: transparent;
  border:0px solid rgba(0,0,0,.06);
  display:inline-block;}
    .brand-lines{display:flex; flex-direction:column}
    .brand-lines .line1{font-size:.825rem; color:#3f3f46; opacity:.9}
    .brand-lines .line2{font-weight:700}
    nav ul{display:flex; gap:10px; list-style:none; margin:0; padding:0; flex-wrap:wrap}
    nav a{
      display:inline-block; padding:8px 10px; border-radius:var(--radius);
      color:#111827; font-weight:600; text-decoration:none; border:1px solid rgba(0,0,0,.06);
    }
    nav a:hover{background:rgba(0,0,0,.06); text-decoration:none}

         /* Hides nav on phone */
    @media (max-width: 600px) {header nav {display: none;}}

    /* Hero */
    .hero{background:var(--bg-alt); border-bottom:1px solid #eadfc5}
    .hero-grid{display:grid; gap:var(--gap-lg); grid-template-columns:1fr; padding:28px 0}
    .hero h1{color:var(--usc-cardinal); margin:0 0 8px}
    .lead{color:var(--muted); margin:0 0 8px}
    .p{margin:0 0 16px}
    .btn{
      display:inline-block; padding:10px 14px; font-weight:700; border-radius:var(--radius);
      border:1px solid transparent; background:var(--usc-cardinal); color:#fff; text-decoration:none;
    }
    .btn:hover{text-decoration:none; filter:brightness(.95)}
    .btn-outline{
      background:#fff; color:var(--usc-cardinal); border:1px solid var(--usc-cardinal);
    }
    .card{
      background:#fff; border:1px solid #e5e7eb; border-radius:var(--radius);
      box-shadow:var(--shadow); padding:14px;
    }
    .card h3{margin:0 0 8px}
    .news-list{display:grid; gap:8px}
    .news-item{display:flex; flex-direction:column; gap:2px}
    .news-item .title{font-weight:600}
    .news-item .date{font-size:.9rem; color:var(--muted)}
    .notice{
      margin-top:10px; font-size:.9rem; color:var(--muted);
      border:1px dashed #d1d5db; border-radius:var(--radius); padding:8px 10px; background:#fff;
    }

    /* Sections */
    section{padding:36px 0}
    .kicker{color:var(--muted); font-weight:700; text-transform:uppercase; letter-spacing:.06em; font-size:.8rem}
    h2{margin:.15rem 0 .75rem}
    .muted{color:var(--muted)}
    .section-desc{margin-top:-.25rem; margin-bottom:1rem; color:var(--muted)}

    /* People */
    .people-controls{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap; margin:10px 0 18px;
    }

.people-controls .workshops-nav {
  margin-left: auto;      /* push to the right */
  display: flex;
  gap: 8px;
}
    .input{
      border:1px solid #d1d5db; border-radius:var(--radius); padding:10px 12px; min-width:260px;
      outline-offset:2px;
    }
    .pill{
      display:inline-block; background:#fff; border:1px solid #d1d5db; padding:6px 10px; border-radius:var(--radius);
      font-size:.9rem; color:#374151;
    }
    .grid{
      display:grid; gap:var(--gap); grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
    }

    /* Make Workshops cards span full width */
    #workshops-grid {
    display: block; /* remove the grid layout */
    }

    #workshops-grid .card {
    width: 97%;
    margin-bottom: var(--gap);
    }


    #opps-grid {grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));}

    .person{display:block}
    .person h3{margin:0 0 4px; font-size:1.05rem}
    .role{font-size:.95rem; color:#374151; margin-bottom:6px}
    .tags{display:flex; flex-wrap:wrap; gap:6px}
    .tag{font-size:.8rem; padding:4px 8px; border:1px solid var(--usc-cardinal); color:var(--usc-cardinal); border-radius:var(--radius); background:#fff}

    .person-photo {
  width: 100%;          /* fill the card width on mobile */
  height: auto;         /* keep aspect ratio */
  max-width: 235px;     /* don’t let it get too huge on desktop */
  border-radius: var(--radius);
  object-fit: cover;
  margin-bottom: 10px;
  background:#f3f4f6;
  display:block;
}

/* Extra breathing room in the header on mobile */
@media (max-width: 600px) {
  header .container {
    padding-left: 20px;
    padding-right: 20px;
  }
  .hero .container {
    padding-left: 20px;
    padding-right: 20px;
  }
}

    /* Workshops */
    .workshop-title{color:var(--usc-cardinal); font-weight:700; margin:0 0 6px; font-size: 1.5rem; line-height: 1.3;}
    .workshop-meta{color:#374151; font-size:.95rem; margin-bottom:8px}

    /* Opportunities & Reports */
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
    .link-btn{
      display:inline-block; padding:6px 10px; border:1px solid var(--usc-cardinal); color:var(--usc-cardinal);
      background:#fff; border-radius:var(--radius); font-weight:600; text-decoration:none;
    }
    .pub{display:flex; align-items:center; justify-content:space-between; gap:10px; border:1px solid #e5e7eb; border-radius:var(--radius); padding:10px 12px; background:#fff}



    /* Activities */
    .workshops-grid{display:grid; gap:var(--gap); grid-template-columns:1fr; }
    @media (min-width:900px){
      .hero-grid{grid-template-columns:1.5fr .6fr}
      .workshops-grid{grid-template-columns:1fr 1fr}
    }
    .workshops-body{min-height:120px}
    .dashed{border:1px dashed #d1d5db; background:#fff}

    .workshop-desc{
  margin: 8px 0 8px;
  color: var(--ink);
}
.workshop-participants{
  margin: 0 0 10px 1.25rem;
  padding: 0;
  list-style: disc;
}
.workshop-participants li{ margin: 4px 0; }



    /* Make activity cards flex columns */
    .workshops-grid .card {
    display: flex;
    flex-direction: column;
    }

    /* Push the button to the bottom, align left */
    .workshops-grid .card .link-btn {
    margin-top: auto;       /* pushes it to bottom */
    align-self: flex-start; /* left edge */
}

    /* Footer */
    footer{background:#fafafa; border-top:1px solid #e5e7eb}
    .foot-grid{display:grid; gap:var(--gap); grid-template-columns:1fr; padding:24px 0}
    .foot-col h4{margin:.25rem 0 .5rem}
    .foot-list{list-style:none; padding:0; margin:0; display:grid; gap:6px}
    .foot-bottom{border-top:1px solid #e5e7eb; padding:12px 0; font-size:.95rem; color:var(--muted)}
    @media (min-width:900px){
      .foot-grid{grid-template-columns:1.1fr .9fr .9fr}
    }
    /* Utility */
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <header>
    <div class="container header-inner" role="navigation" aria-label="Primary">
      <div class="brand">
        <span class="brand-tile" aria-hidden="true">RTG</span>
        <div class="brand-lines">
          <span class="line1">University of Southern California</span>
          <span class="line2">RTG: Geometry and Representation Theory at USC</span>
        </div>
      </div>
      <nav>
        <ul>
          <li><a href="index.html">RTG Homepage</a></li>
          <li><a href="#workshops">Workshops</a></li>
          <li><a href="#reports">Reports</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="main">
    <!-- Hero -->
    <section class="hero" aria-label="Hero">
      <div class="container hero-grid">
        <div>
          <h1>RTG Current Developments Mini-Workshops</h1>
          <p class="lead">Department of Mathematics • University of Southern California</p>
          <p class="p" id="hero-summary">Welcome to the homepage of the RTG Current Development Mini-Workshops at USC. These workshops support up to four researchers for short, intensive periods of lectures, problem sessions and research at USC, in collaborations with RTG personnel. This page hosts workshop summaries and post-workshop reports. We are gratefully supported by the National Science Foundation under award DMS-2446019. </p>
          <a class="btn btn-outline" href="#workshops" role="button" aria-label="Jump to upcoming workshops">Recent and upcoming workshops</a>
        </div>
        <aside class="card" aria-labelledby="news-title">
          <h3 id="news-title">News &amp; Announcements</h3>
          <div id="news-list" class="news-list" aria-live="polite"></div>
        </aside>
      </div>
    </section>

<section id="workshops" aria-labelledby="workshops-title">
  <div class="container">
    <h2 id="workshops-title">Workshops</h2>

<div class="people-controls">
  <label for="workshops-filter" class="sr-only">Filter workshops</label>
  <input id="workshops-filter" class="input" type="search"
         placeholder="Filter by title, type, location, or date…">
  <span id="workshops-count" class="pill">0 shown</span>

  <!-- pager buttons now inline -->
  <div class="workshops-nav">
    <button id="workshops-prev" class="link-btn" type="button" aria-label="Previous page">‹ Prev</button>
    <button id="workshops-next" class="link-btn" type="button" aria-label="Next page">Next ›</button>
  </div>
</div>

    <div id="workshops-grid" class="grid" aria-live="polite"></div>
  </div>
</section>

    <!-- Reports -->
    <section id="reports" aria-labelledby="Reports-title">
      <div class="container">
        <h2 id="Reports-title">Workshop Reports</h2>
        <div id="Reports-list" class="grid" style="grid-template-columns:1fr;"></div>
      </div>
    </section>

  <footer aria-labelledby="footer-title">
    <div class="container foot-grid">
      <div class="foot-col">
        <h4 id="footer-title" class="muted">USC • Department of Mathematics</h4>
        <div class="muted">RTG: Geometry and Representation Theory at USC</div>
      </div>
      <div class="foot-col">
        <h4>Contact</h4>
        <ul id="pi-contacts" class="foot-list"></ul>
        <div id="no-pi" class="muted" style="display:none">No PI contacts found.</div>
      </div>
      <div class="foot-col">
        <h4>Quick links</h4>
        <ul class="foot-list">
          <li><a href="#workshops">Workshops</a></li>
          <li><a href="#reports">Reports</a></li>
        </ul>
      </div>
    </div>
    <div class="container foot-bottom">
      <span id="copyright"></span>
    </div>
  </footer>

  <script>
  (function(){
    // ---------- Helpers ----------
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const safe = (el, fn) => { if(el) fn(el); };

    function fmt(dateStr){
      const d = new Date(dateStr + (dateStr.match(/T|Z/) ? '' : 'T00:00:00'));
      if (Number.isNaN(d.valueOf())) return dateStr;
      return d.toLocaleDateString(undefined, {month:'short', day:'numeric', year:'numeric'});
    }

    function fmtRange(startStr, endStr){
  if(!startStr && !endStr) return "";
  if(startStr && !endStr) return fmt(startStr);
  if(!startStr && endStr) return fmt(endStr);

  const s = new Date(startStr + (/(T|Z)/.test(startStr||'')?'':'T00:00:00'));
  const e = new Date(endStr   + (/(T|Z)/.test(endStr||'')  ?'':'T00:00:00'));
  if (Number.isNaN(s) || Number.isNaN(e)) return `${fmt(startStr)} – ${fmt(endStr)}`;

  const sameYear = s.getFullYear() === e.getFullYear();
  const sameMonth = sameYear && s.getMonth() === e.getMonth();
  if (sameMonth){
    // "Nov 8–10, 2025"
    const mo = s.toLocaleDateString(undefined,{month:'short'});
    return `${mo} ${s.getDate()}–${e.getDate()}, ${s.getFullYear()}`;
  }
  if (sameYear){
    // "Nov 30 – Dec 2, 2025"
    const left  = s.toLocaleDateString(undefined,{month:'short', day:'numeric'});
    const right = e.toLocaleDateString(undefined,{month:'short', day:'numeric', year:'numeric'});
    return `${left} – ${right}, ${s.getFullYear()}`;
  }
  // different years: "Dec 30, 2025 – Jan 2, 2026"
  return `${fmt(startStr)} – ${fmt(endStr)}`;
}

function joinEsc(arr, sep=', '){
  return (Array.isArray(arr)?arr:[]).map(escapeHtml).join(sep);
}


    function mdToHtml(md){
      if(!md) return "";
      // Normalize newlines
      const lines = md.replace(/\r\n?/g, '\n').split('\n');
      let html = "", inList=false;
      function closeList(){ if(inList){ html += '</ul>'; inList=false; } }
      for(const raw of lines){
        const line = raw.trimEnd();
        if(/^###\s+/.test(line)){ closeList(); html += `<h3>${escapeHtml(line.replace(/^###\s+/,''))}</h3>`; continue; }
        if(/^##\s+/.test(line)){ closeList(); html += `<h2>${escapeHtml(line.replace(/^##\s+/,''))}</h2>`; continue; }
        if(/^#\s+/.test(line)){ closeList(); html += `<h1>${escapeHtml(line.replace(/^#\s+/,''))}</h1>`; continue; }
        if(/^(\-|\*)\s+/.test(line)){
          if(!inList){ html += '<ul>'; inList=true; }
          html += `<li>${escapeHtml(line.replace(/^(\-|\*)\s+/,''))}</li>`;
          continue;
        }
        if(line === ''){
          closeList();
        } else {
          closeList();
          html += `<p>${escapeHtml(line)}</p>`;
        }
      }
      closeList();
      return html;
    }

    function escapeHtml(s){
      return String(s??'')
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;');
    }

    async function loadJSON(path, fallback){
      try{
        const res = await fetch(path, {cache:'no-store'});
        if(!res.ok) throw new Error(res.statusText);
        const data = await res.json();
        return {data, from:path};
      }catch(e){
        return {data:fallback, from:'fallback'};
      }
    }

    async function loadText(path, fallback){
      try{
        const res = await fetch(path, {cache:'no-store'});
        if(!res.ok) throw new Error(res.statusText);
        const data = await res.text();
        return {data, from:path};
      }catch(e){
        return {data:fallback, from:'fallback'};
      }
    }

    // ---------- Fallback data (embedded) ----------
    const FALLBACK = {
      people: [
        // PIs (with emails for footer; emails never shown on cards)
        { name:"Aravind Asok", role:"Principal Investigator", email:"asok@usc.edu", photo: "photos/asok.avif", interests:["Algebraic geometry","Homotopy theory"] },
        { name:"Sami Assaf", role:"Principal Investigator", email:"assaf@usc.edu", photo: "photos/assaf.avif", interests:["Combinatorics","Representation theory"] },
        { name:"Julian Chaidez", role:"Principal Investigator", email:"chaidez@usc.edu", photo: "photos/chaidez.avif", interests:["Symplectic topology","Dynamical systems"] },
        { name:"Sheel Ganatra", role:"Principal Investigator", email:"sganatra@usc.edu", photo: "photos/ganatra.jpeg", interests:["Symplectic topology","Mirror symmetry"] },
        { name:"Aaron Lauda", role:"Principal Investigator", email:"lauda@usc.edu", photo: "photos/lauda.avif", interests:["Categorification","Low-dimensional topology"] },
        // Affiliates (omit emails)
        { name:"Cymra Haskell", role:"Affiliated Faculty", photo: "photos/haskell.png", interests:["Ergodic theory","Math education"] },
        { name:"Cris Negron", role:"Affiliated Faculty", photo: "photos/negron.jpg", interests:["Representation theory","Algebra"] },
        { name:"Kyler Siegel", role:"Affiliated Faculty", photo: "photos/siegel.avif", interests:["Symplectic topology","Complex geometry"] },
        { name:"Alicia Tabing", role:"Affiliated Faculty", photo: "photos/tabing.avif", interests:["Topology","Mathematical art"] },
        { name:"Paul Tokorcheck", role:"Affiliated Faculty", photo: "photos/tokorcheck.avif", interests:["Number theory","Math education"] },
        { name:"Harold Williams", role:"Affiliated Faculty", photo: "photos/williams.jpg", interests:["Mathematical physics","Representation theory"] },
      ],
      workshops: [
          {
    "start": "2025-11-08",           // ISO (YYYY-MM-DD) or full datetime
    "end":   "2025-11-10",           // optional; if missing, treated as single-day
    "title": "RTG Workshop on Symplectic and Hyperbolic Dynamics",
    "where": "KAP 414",
    "type":  "Workshop",
    "link":  "#",
    "desc":  "This workshop is focused on the emerging interactions between symplectic and hyperbolic dynamics.",
    "participants": ["Julian Chaidez (USC)", "Thomas Massoni (Stanford)", "Jonathan Zung (Georgia Tech)", "Thomas Barthelme (Queens)"]   // optional list
  },
  {
    "start": "2025-11-08",           // ISO (YYYY-MM-DD) or full datetime
    "end":   "2025-11-10",           // optional; if missing, treated as single-day
    "title": "RTG Workshop on Symplectic and Hyperbolic Dynamics",
    "where": "KAP 414",
    "type":  "Workshop",
    "link":  "#",
    "desc":  "This workshop is focused on the emerging interactions between symplectic and hyperbolic dynamics.",
    "participants": ["Julian Chaidez (USC)", "Thomas Massoni (Stanford)", "Jonathan Zung (Georgia Tech)", "Thomas Barthelme (Queens)"]   // optional list
  },
  {
    "start": "2025-11-08",           // ISO (YYYY-MM-DD) or full datetime
    "end":   "2025-11-10",           // optional; if missing, treated as single-day
    "title": "RTG Workshop on Symplectic and Hyperbolic Dynamics",
    "where": "KAP 414",
    "type":  "Workshop",
    "link":  "#",
    "desc":  "This workshop is focused on the emerging interactions between symplectic and hyperbolic dynamics.",
    "participants": ["Julian Chaidez (USC)", "Thomas Massoni (Stanford)", "Jonathan Zung (Georgia Tech)", "Thomas Barthelme (Queens)"]   // optional list
  },
      ],
      opportunities: [
        { title:"USC RTG Postdoctoral Fellowships", details:"The USC RTG Postdoctoral Fellowship is a 3-year position that involves research and teaching. We seek outstanding applicants with research interests in representation theory, symplectic geometry, topology  and other areas well-aligned with our group. Applicants must be citizens, nationals, or permanent residents of the USA or its territories and possessions. Please click apply to visit Mathjobs for more information.", link:"#people" },
        { title:"2026 Mathematics Summer Research Program", details:"The USC RTG Mathematics Summer Research Program is a 10 week summer research program for advanced undergraduates. We seek outstanding and motivated applicants with strong course preparation in pure math. Applicants must be citizens, nationals, or permanent residents of the USA or its territories and possessions. Please click apply to visit Mathprograms for more information.", link:"#workshops" }
      ],
      reports: [
        { citation:"Coming soon!", link:"#"}
      ],
      workshopsMd: [
      ].join("\n")
    };

    // ---------- Load all content ----------
    Promise.all([
      loadJSON('data/people.json', FALLBACK.people),
      loadJSON('data/workshops.json', FALLBACK.workshops),
      loadJSON('data/opportunities.json', FALLBACK.opportunities),
      loadJSON('data/workshop_reports.json', FALLBACK.reports),
    ]).then(([peopleRes, workshopsRes, oppsRes, ReportsRes])=>{
      const usedFallback = [peopleRes, workshopsRes, oppsRes, ReportsRes].some(r=>r.from==='fallback');
      if(usedFallback) safe($('#defaults-indicator'), el => el.style.display='block');

      // Render sections with guards
      renderNews(workshopsRes.data);
      renderPeople(peopleRes.data);
      renderWorkshops(workshopsRes.data);
      renderOpps(oppsRes.data);
      renderReports(ReportsRes.data);

      buildFooterContacts(peopleRes.data);
      setCopyright();

      // Self-tests
      selfTests({people:peopleRes.data, workshops:workshopsRes.data, usedFallback});
    });

    // ---------- Renderers ----------
    function renderNews(workshops){
      const list = $('#news-list'); if(!list) return;
      const items = [...workshops]
        .filter(e=>e && e.date)
        .sort((a,b)=> new Date(b.date)-new Date(a.date))
        .slice(0,3);
      list.innerHTML = items.map(e=>`
        <div class="news-item">
          <span class="title">${escapeHtml(e.title || "Workshop")}</span>
          <span class="date">${fmt(e.date)}</span>
        </div>
      `).join('') || `<div class="muted">No announcements yet.</div>`;
    }

    function normalizeRole(role){
      if(typeof role !== 'string') return role;
      return role === 'PI' ? 'Principal Investigator' : role;
    }

    function renderPeople(people){
      const grid = $('#people-grid'); if(!grid) return;
      const count = $('#people-count');

      const records = (people || []).map(p => ({...p, role: normalizeRole(p.role)}));

      function applyFilter(){
        const q = ($('#people-filter')?.value || '').trim().toLowerCase();
        const filtered = !q ? records : records.filter(p=>{
          const hay = [
            p.name||'',
            p.role||'',
            ...(Array.isArray(p.interests)?p.interests:[])
          ].join(' ').toLowerCase();
          return hay.includes(q);
        });
        grid.innerHTML = filtered.map(p=> personCard(p)).join('') || `<div class="muted">No people match the filter.</div>`;
        if(count) count.textContent = `${filtered.length} shown`;
      }

      function personCard(p){
        const tags = (Array.isArray(p.interests)?p.interests:[]).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join(' ');
        const hasPhoto = typeof p.photo === 'string' && p.photo.trim().length>0;
        const imgHtml = hasPhoto
          ? `<img src="${p.photo}" alt="Photo of ${escapeHtml(p.name||'')}" class="person-photo" loading="lazy" decoding="async">`
          : '';
        return `
          <article class="card person" aria-label="${escapeHtml(p.name||'Person')}">
            ${imgHtml}
            <h3>${escapeHtml(p.name||'')}</h3>
            <div class="role">${escapeHtml(p.role||'')}</div>
            <div class="tags">${tags}</div>
          </article>
        `;
      }

      // Init
      applyFilter();
      const input = $('#people-filter');
      if(input){ input.addEventListener('input', applyFilter); }
    }

function renderWorkshops(workshops){
  const grid   = $('#workshops-grid');      if(!grid) return;
  const count  = $('#workshops-count');     // optional pill in the filter bar
  const input  = $('#workshops-filter');    // optional search box
  const prev   = $('#workshops-prev');      // optional pager buttons
  const next   = $('#workshops-next');

  const PAGE_SIZE = 2; // now 2 per page
  let pageIndex = 0;

  // Normalize + sort newest → oldest (prefer start/end, fallback to date)
  const normalized = (workshops||[]).map(e=>{
    const start = e.start || e.date || '';
    const end   = e.end   || '';
    const _start = new Date(start + (/(T|Z)/.test(start||'')?'':'T00:00:00'));
    const key = Number.isNaN(_start) ? new Date(0) : _start;
    return {...e, _start, _key: key};
  }).sort((a,b)=> b._key - a._key);

  // Build haystack for search
  const withHay = normalized.map(e=>{
    const parts = [
      e.title||'', e.type||'', e.where||'',
      e.date||'', e.start||'', e.end||'',
      fmt(e.date||e.start||''), fmt(e.end||''),
      e.desc||'',
      ...(Array.isArray(e.participants)?e.participants:[])
    ];
    return {...e, __hay: parts.join(' ').toLowerCase()};
  });

  function dateText(e){
    if(e.start || e.end) return fmtRange(e.start, e.end);
    if(e.date) return fmt(e.date);
    return '';
  }

  function card(e){
    const meta = [dateText(e), e.type||null, e.where||null].filter(Boolean).join(' • ');
    const descHtml = e.desc ? `<p class="workshop-desc">${escapeHtml(e.desc)}</p>` : '';
    const partHtml = (Array.isArray(e.participants) && e.participants.length)
      ? `<div class="workshop-participants-block">
           <strong>Invited Researchers:</strong>
           <ul class="workshop-participants">
             ${e.participants.map(n=>`<li>${escapeHtml(n)}</li>`).join('')}
           </ul>
         </div>`
      : '';

    return `
      <article class="card" style="display:flex;flex-direction:column;gap:6px;">
        <div>
          <div class="workshop-title">${escapeHtml(e.title||'Workshop')}</div>
          <div class="workshop-meta">${escapeHtml(meta)}</div>
          ${descHtml}
          ${partHtml}
        </div>
      </article>
    `;
  }

  function currentFiltered(){
    const q = (input?.value || '').trim().toLowerCase();
    return q ? withHay.filter(e => e.__hay.includes(q)) : withHay;
  }

  function totalPages(len){ return Math.max(1, Math.ceil(len / PAGE_SIZE)); }

  function renderPage(){
    const filtered = currentFiltered();
    const pages = totalPages(filtered.length);
    if(pageIndex >= pages) pageIndex = pages - 1;

    const start = pageIndex * PAGE_SIZE;
    const pageItems = filtered.slice(start, start + PAGE_SIZE);

    grid.innerHTML = pageItems.map(card).join('') || `<div class="muted">No workshops match.</div>`;

    if(count){
      count.textContent = filtered.length
        ? `Showing ${start+1}–${Math.min(start+PAGE_SIZE, filtered.length)} of ${filtered.length} • Page ${pageIndex+1} of ${pages}`
        : `No results`;
    }
    if(prev) prev.disabled = (pageIndex === 0 || filtered.length === 0);
    if(next) next.disabled = (pageIndex >= pages-1 || filtered.length === 0);
  }

  function goto(delta){ pageIndex = Math.max(0, pageIndex + delta); renderPage(); }

  if(input) input.addEventListener('input', ()=>{ pageIndex = 0; renderPage(); });
  if(prev)  prev.addEventListener('click', ()=> goto(-1));
  if(next)  next.addEventListener('click', ()=> goto(+1));

  renderPage();
}


    function renderOpps(opps){
      const grid = $('#opps-grid'); if(!grid) return;
      grid.innerHTML = (opps||[]).map(o=>`
        <article class="card">
          <div class="row">
            <h3 style="margin:0">${escapeHtml(o.title||'Opportunity')}</h3>
            ${o.link?`<a class="link-btn" href="${o.link}">Apply</a>`:''}
          </div>
          <p class="muted" style="margin:.25rem 0 0">${escapeHtml(o.details||'')}</p>
        </article>
      `).join('') || `<div class="muted">No opportunities available.</div>`;
    }

    function renderReports(Reports){
      const list = $('#Reports-list'); if(!list) return;
      list.innerHTML = (Reports||[]).map(p=>`
        <div class="pub">
          <span class="muted">${escapeHtml(p.citation||'')}</span>
          ${p.link?`<a class="link-btn" href="${p.link}" target="_blank" rel="noopener">Link</a>`:''}
        </div>
      `).join('') || `<div class="muted">No reports listed.</div>`;
    }

    function buildFooterContacts(people){
      const ul = $('#pi-contacts'); if(!ul) return;
      const regex = /\b(PI|Principal Investigator)\b/i;
      const pis = (people||[])
        .map(p=>({...p, role: normalizeRole(p.role)}))
        .filter(p => typeof p.role === 'string' && regex.test(p.role));
      if(pis.length === 0){
        $('#no-pi') && ($('#no-pi').style.display='block');
        return;
      }
      ul.innerHTML = pis.map(p=>{
        const name = escapeHtml(p.name||'');
        if(p.email){
          const mail = `mailto:${encodeURIComponent(p.email)}?subject=${encodeURIComponent('RTG Inquiry')}`;
          return `<li><a href="${mail}">${name}</a></li>`;
        }
        return `<li>${name}</li>`;
      }).join('');
    }

    function setCopyright(){
      const y = new Date().getFullYear();
      const el = $('#copyright'); if(el) el.textContent = `© ${y} University of Southern California • Department of Mathematics`;
    }

    // ---------- Self-tests ----------
    function selfTests({people, workshops, usedFallback}){
      const tests = [];
      tests.push({name:'Color token: cardinal', pass: getComputedStyle(document.documentElement).getPropertyValue('--usc-cardinal').trim()==='#990000'});
      tests.push({name:'Color token: gold', pass: getComputedStyle(document.documentElement).getPropertyValue('--usc-gold').trim()==='#FFCC00'});
      tests.push({name:'People length ≥ 5', pass: Array.isArray(people) && people.length>=5});
      tests.push({name:'Workshops length ≥ 1', pass: Array.isArray(workshops) && workshops.length>=1});
      tests.push({name:'Workshop dates parse', pass: Array.isArray(workshops) && workshops.every(e=>!Number.isNaN(new Date(e.date).valueOf()))});
      // Build contacts same way as footer
      const regex = /\b(PI|Principal Investigator)\b/i;
      const piCount = (people||[]).map(p=>({...p, role: normalizeRole(p.role)})).filter(p=>typeof p.role==='string' && regex.test(p.role)).length;
      tests.push({name:'Footer PI contacts ≥ 1', pass: piCount>=1});
      if(usedFallback) tests.push({name:'Using defaults indicator shown', pass: ($('#defaults-indicator') && $('#defaults-indicator').style.display!=='none')});

      console.groupCollapsed('RTG static page self-tests');
      for(const t of tests){
        console[t.pass ? 'log' : 'error']((t.pass?'PASS: ':'FAIL: ')+t.name);
      }
      console.groupEnd();
    }

  })();
  </script>
</body>
</html>








